From f663fbc6e30e259566c527c58fc85613eeb24e5d Mon Sep 17 00:00:00 2001
From: LeftPathLane <paulsexecutables@gmail.com>
Date: Sun, 17 Sep 2017 16:53:44 +1000
Subject: [PATCH] book exploit patch


diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java
index b531835d..01500971 100644
--- a/src/main/java/net/minecraft/server/PlayerConnection.java
+++ b/src/main/java/net/minecraft/server/PlayerConnection.java
@@ -1814,7 +1814,9 @@ public class PlayerConnection implements PacketPlayInListener {
                     }
 
                     if (itemstack.getItem() == Items.BOOK_AND_QUILL && itemstack.getItem() == itemstack1.getItem()) {
-                        CraftEventFactory.handleEditBookEvent(player, itemstack); // CraftBukkit
+                        itemstack1 = new ItemStack(Items.BOOK_AND_QUILL);
+                        itemstack1.a("pages", (NBTBase) itemstack.getTag().getList("pages", 8));
+                        CraftEventFactory.handleEditBookEvent(player, itemstack1); // CraftBukkit
                     }
 
                     return;
@@ -1846,7 +1848,16 @@ public class PlayerConnection implements PacketPlayInListener {
                     }
 
                     if (itemstack.getItem() == Items.WRITTEN_BOOK && itemstack1.getItem() == Items.BOOK_AND_QUILL) {
-                        CraftEventFactory.handleEditBookEvent(player, itemstack); // CraftBukkit
+                        itemstack1 = new ItemStack(Items.WRITTEN_BOOK);
+                        itemstack1.a("author", (NBTBase) (new NBTTagString(this.player.getName())));
+                        itemstack1.a("title", (NBTBase) (new NBTTagString(itemstack.getTag().getString("title").replace("\u00A7", ""))));
+                        NBTTagList pages = new NBTTagList();
+                        for (int i = 0; i < itemstack.getTag().getList("pages", 8).size(); i++) {
+                            pages.add(new NBTTagString(itemstack.getTag().getList("pages", 8).getString(i).replace("\u00A7", "")));
+                        }
+                        itemstack1.a("pages", (NBTBase) pages);
+                        itemstack1.setItem(Items.WRITTEN_BOOK);
+                        CraftEventFactory.handleEditBookEvent(player, itemstack1); // CraftBukkit
                     }
 
                     return;
-- 
2.14.1.windows.1

